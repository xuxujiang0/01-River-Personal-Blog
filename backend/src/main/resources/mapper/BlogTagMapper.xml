<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.river.blog.mapper.BlogTagMapper">
    
    <!-- 根据名称查询标签ID -->
    <select id="selectIdByName" resultType="long">
        SELECT id FROM blog_tags WHERE name = #{name}
    </select>
    
    <!-- 插入标签 -->
    <insert id="insertTag">
        INSERT INTO blog_tags (name) VALUES (#{name})
    </insert>
    
    <!-- 查询文章的所有标签 -->
    <select id="selectTagsByPostId" resultType="string">
        SELECT t.name
        FROM blog_tags t
        INNER JOIN blog_post_tags pt ON t.id = pt.tag_id
        WHERE pt.post_id = #{postId}
    </select>
    
    <!-- 插入文章-标签关联 -->
    <insert id="insertPostTag">
        INSERT INTO blog_post_tags (post_id, tag_id) VALUES (#{postId}, #{tagId})
    </insert>
    
    <!-- 删除文章的所有标签关联 -->
    <delete id="deletePostTags">
        DELETE FROM blog_post_tags WHERE post_id = #{postId}
    </delete>
    
    <!-- 获取所有标签（按创建时间降序） -->
    <select id="selectAllTags" resultType="map">
        SELECT 
            id,
            name,
            created_at as createdAt,
            (SELECT COUNT(*) FROM blog_post_tags WHERE tag_id = blog_tags.id) as postCount
        FROM blog_tags
        ORDER BY created_at DESC
    </select>
    
</mapper>
